<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style type="text/css">
        body {
            background: #edeeef;
        }
        #menu a {
            color: #989898;
            font-family: "Helvetica Neue", Helvetica, Arial,'Microsoft YaHei','PingFang SC Regular',sans-serif !important;
            font-size: medium;
            font-weight: bold;
        }
        #menu li {
            padding: 5px 5px 5px 0;
        }
        #menu a:hover{
            color: #5bc0de;
        }
        table {
            border-collapse:separate;
            border-spacing:0 2rem;
        }
        td,tr{
            padding: 5px;
        }
        table tr, table{
            width: 100% !important
        }
        table tr td:nth-child(2){
            width: 60%;
        }
        tabletr td:nth-child(3){
            width: 25%;
        }
        table td b {
            color: green;
        }
    </style>

</head>
<body>
<header class="cd-main-header">
    <div class="cd-main-header__container container container--lg">
        <nav class="nav navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <!--在移动端的时候导航条折叠起来，三横的样式出现，点击该样式可以显示或隐藏导航条上的内容-->
                    <button class="navbar-toggle" data-toggle="collapse" data-target="#menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <span href="#" ><img src="images/head_logo.png" alt=""></span>
                </div>
                <div id="menu" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="/index">首页</a></li>
                        <li><a href="/contestInfo">报名</a></li>
                        <li><a href="/ContestResult">竞赛成绩</a></li>
                        <li><a href="/CL.action">优秀师生</a></li>
                        <li><a href="/uploadworks">作品提交</a></li>
                        <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <div th:text="${session.USER.username}" class="qwer" style="display: inline-block"> </div><span class="caret "></span></a>
                            <ul class="dropdown-menu">

                                <li><a href="/userInfo">个人信息</a></li>
                                <li><a href="/CreatGroupInfo">小组信息</a></li>
                                <li th:if="${session.USER.role}==1"><a href="/mclist.action">竞赛管理</a></li>
                                <li th:if="${session.USER.role}==1"><a href="/MNlist.action">通知管理</a></li>
                                <li><a href="/logout.action">注销</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</header>
<main>
    <div class="container" style="background:#fff;margin-top: 100px;">
        <div class="row">
            <div class="breadcrumb" >
                <h6 style="font: 20px 'Microsoft YaHei',arial,tahoma,\5b8b\4f53,sans-serif;">个人信息</h6>
            </div>
            <div class="container">
                <div class="col-md-6"><img width="100%" height="100%" src="images/ava.jpg" alt="" style="padding-bottom: 20px;cursor: pointer"></div>
                <div class="col-md-6 text-center">
                   <!-- <form action="/updateInfo" method="post">-->
                    <span class="history">
                        <ul id="myTab" class="nav nav-tabs">
                           <li class="active"><a href="#messagepane" data-toggle="tab">个人信息</a></li>
                           <li><a href="#passwordpane" data-toggle="tab">密码修改</a></li>
                        </ul>
                    </span>
                    <div id="myTabContent" class="tab-content">
                        <div class="tab-pane fade in active" id="messagepane">
                            <table id="selfmessge">
                                <input name="c_id" type="hidden" th:value="${userInfo?.c_id}">
                                <input name="c_id" id="c_id" class="form-control" type="hidden" th:value="${userInfo?.c_id}" />
                                <tr>
                                    <td>学号</td>
                                    <td>
                                        <input id="sno" class="form-control" type="text" disabled th:value="${userInfo?.c_sno}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>姓名</td>
                                    <td>
                                        <input id="name"  class="form-control" type="text" th:value="${userInfo?.c_name}" style="display: inline"/>
                                    </td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td>性别</td>
                                    <td>
                                        <span class="col-md-6"><input type="radio" id="women" value="女"  name="1" th:checked="${userInfo.c_gender=='女'}" >&nbsp;&nbsp;女</span>
                                        <span class="col-md-6"><input type="radio" id="man" value="男" checked="checked" name="1" th:checked="${userInfo.c_gender=='男'}">&nbsp;&nbsp;男</span>
                                    </td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td>专业班级</td>
                                    <td>
                                        <input id="major"  class="form-control" type="text" th:value="${userInfo?.c_major}" />
                                    </td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td>手机号</td>
                                    <td>
                                        <input id="phone"  class="form-control" type="text" th:value="${userInfo?.c_phone}" />
                                    </td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td>QQ号</td>
                                    <td>
                                        <input id="qq"  class="form-control" type="text" th:value="${userInfo?.c_QQ}" />
                                    </td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3"><input id="send" type="submit"  class="btn btn-primary pull-right" value="提交修改"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="tab-pane fade" id="passwordpane">
                            <table id="passwordtable">
                                <tr>
                                    <td>用户名</td>
                                    <td><input  class="form-control" type="text"  th:value="${userInfo?.c_sno}" disabled/></td>
                                </tr>
                                <tr>
                                    <td>原密码</td>
                                    <td><input  type="text"  id="oldpass" class="form-control"></td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>

                                <tr>
                                    <td>新密码</td>
                                    <td><input type="text"  id="newpass" class="form-control"></td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td>确认密码</td>
                                    <td><input type="text" id="repass" class="form-control"></td>
                                    <td>
                                        <b>✔</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3"><input id="send2"  class="btn btn-primary pull-right" value="提交修改"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <!--</form>-->
                </div>
            </div>
        </div>
    </div>
</main>
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script src="js/bootstrap.js"></script>
<script>
    $(function () {
        var sno = $('#sno').val();
        var name = $('#name').val();
        var sex = $('input:radio:checked').val();
        var major = $('#major').val();
        var phone = $('#phone').val();
        var qq = $('#qq').val();
        //拟态框内 数据判断
        //名字 2-3位汉字
        $('#name').bind('input propertychange',function(){
            var rename = /^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/;
            if($(this).val() == ""){
                $(this).parent().next().children().text('姓名不能为空').css('color','red');
            }else if(rename.test($(this).val()) == false){
                $(this).parent().next().children().text('姓名格式错误').css('color','red');
            }else{
                $(this).parent().next().children().text('✔').css('color','green');
            }
            submitok();
        });
        //专业班级 2-3位汉字+3位数字
        $('#major').bind('input propertychange',function(){
            var remajor = /^[\u4E00-\u9FA5]{1,}\d{3}$/;
            if($(this).val() == ""){
                $(this).parent().next().children().text('专业班级不能为空').css('color','red');
            }else if(remajor.test($(this).val()) == false){
                $(this).parent().next().children().text('专业班级格式错误').css('color','red');
            }else{
                $(this).parent().next().children().text('✔').css('color','green');
            }
            submitok();
        });
        //手机号 1开头11位数字
        $('#phone').bind('input propertychange',function(){
            var reMobile = /^1\d{10}$/;
            if($(this).val() == ""){
                $(this).parent().next().children().text('手机号不能为空').css('color','red');
            }else if(reMobile.test($(this).val()) == false){
                $(this).parent().next().children().text('手机号格式错误').css('color','red');
            }else{
                $(this).parent().next().children().text('✔').css('color','green');
            }
            submitok();
        });
        //qq号 3-9位数字
        $('#qq').bind('input propertychange',function(){
            var reqq = /^[1-9]\d{3,9}$/;
            if($(this).val() == ""){
                $(this).parent().next().children().text('QQ号不能为空').css('color','red');
            }else if(reqq.test($(this).val()) == false){
                $(this).parent().next().children().text('QQ号格式错误').css('color','red');
            }else{
                $(this).parent().next().children().text('✔').css('color','green');
            }
            submitok();
        });
        //按钮确认修改
        //修改个人信息
        $('#send').click(function () {
            var sno = $('#sno').val();
            var name = $('#name').val();
            var sex = $('input:radio:checked').val();
            var major = $('#major').val();
            var phone = $('#phone').val();
            var qq = $('#qq').val();
            $.ajax({
                type: "POST",
                url: "/updateInfo",
                data: {'c_id':$('#c_id').val(),'c_sno':sno,'c_name':name,'c_gender':sex,'c_major':major,'c_phone':phone,'c_QQ':qq},
                success: function (ok) {
                    if(ok){alert('修改成功')}
                }
            });
        });
        //修改密码
        $('#send2').click(function () {
            var oldp = $('#oldpass').val();
            var newp = $('#newpass').val();
            var rep = $('#repass').val();

            $.ajax({
                type: "POST",
                url: "/#",
                data: {},
                success: function (ok) {
                    if(ok){alert('修改成功')}
                }
            });
        });
        //监控 √ 是否变化
        function submitok(){
            var j = 0;
            $('#selfmessge b').each(function () {
                /*console.log($(this).text().length);*/
                if($(this).text().length == 1){
                    j++;
                }
            });
            console.log(j);
            if(j == 5){
                $('#send').attr('disabled',false);
            }else{
                $('#send').attr('disabled',true);
            }
        }
    });
</script>
</body>
</html>